apiVersion: kubeadm.k8s.io/v1beta2
kind: ClusterConfiguration
kubernetesVersion: v1.20.0
apiServer:
  certSANs:
  - 127.0.0.1
  - cluster-api.example.com
  - 192.168.1.131
  - 192.168.1.132
  - 192.168.1.133 
  extraArgs:
    advertise-address: "{{ kubernetes_apiserver_advertise_address | default(ansible_default_ipv4.address, true) }}"
    enable-admission-plugins: NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,NodeRestriction,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota
    authorization-mode: Node,RBAC
dns:
  type: CoreDNS
clusterName: kubernetes
controlPlaneEndpoint: k8s-cp:{{k8s_cp_port}}
networking:
  podSubnet: "{{ kubernetes_pod_network.cidr }}"
  dnsDomain: "cluster.local"

apiVersion: kubeproxy.config.k8s.io/v1alpha1
kind: KubeProxyConfiguration
mode: "ipvs"

apiVersion: kubeadm.k8s.io/v1beta2
kind: InitConfiguration
nodeRegistration:
  criSocket: "/run/containerd/containerd.sock"
  kubeletExtraArgs:
    cgroup-driver: "systemd"

apiVersion: kubelet.config.k8s.io/v1beta1
kind: KubeletConfiguration
cgroupDriver: systemd

